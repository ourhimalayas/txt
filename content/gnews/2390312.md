###  [:house:返回](README.md)
---


## ERC404的爆火让NFT再次伟大？技术角度解析其机制及原理
`3/13/2024 6:00 AM UTC ` [轉載自GNews](https://gnews.org/articles/2390312)

作者：**ZAN Team**

![ERC404的爆火让NFT再次伟大？技术角度解析其机制及原理](https://cdn-img.panewslab.com/panews/images/hSpgUD7262.png "ERC404的爆火让NFT再次伟大？技术角度解析其机制及原理")

### 什么是图币二象性？

币一般指链原生 Token 或者类似 ERC20 协议的同质化 Token，常见的比如 BTC、ETH、USDT 等。

图指的是符合 ERC721 协议的非同质化 Token（NFT），比如 CryptoPunks、无聊猿、mfers 等，国内的数字藏品平台（比如鲸探）发行的 3D 模型资产也认为是图。

Token 和 NFT 都有它自己的局限，比如 Token 的流动性比较强，但其本身没有炒作价值，NFT 有稀有性和独特性，但往往流动性很差，而且大多是蓝筹项目或集中于地板价。

![ERC404的爆火让NFT再次伟大？技术角度解析其机制及原理](https://cdn-img.panewslab.com/panews/images/CXCN2nbFJP.png "ERC404的爆火让NFT再次伟大？技术角度解析其机制及原理")

某 NFT 项目的流动性深度图

图币二象性是指通过某种方式将 Token 和 NFT 混合的规范。

我们以 Ethereum 为例，一个支持图币二象性的项目，它应该即是同质的也是非同质化的，它既可以享受到 Token 所带来的高流动性，又能实现稀有性和独特性，具备炒作价值。

但这样的东西真的存在吗？NFT 的价格和它的稀有度是挂钩的，为什么可以做到同质？

![ERC404的爆火让NFT再次伟大？技术角度解析其机制及原理](https://cdn-img.panewslab.com/panews/images/L6VXz23g1Q.png "ERC404的爆火让NFT再次伟大？技术角度解析其机制及原理")![ERC404的爆火让NFT再次伟大？技术角度解析其机制及原理](https://cdn-img.panewslab.com/panews/images/OE45QlI3Ql.png "ERC404的爆火让NFT再次伟大？技术角度解析其机制及原理")

#80 挂单价 18.3E                          #7520 挂单价 281.4E ### ERC404 打开了[[zh:潘多拉魔盒]]

2024 年春节期间，一个名为 ERC404 的实验性协议和其第一个项目 Pandora 迅速的火出圈。

![ERC404的爆火让NFT再次伟大？技术角度解析其机制及原理](https://cdn-img.panewslab.com/panews/images/KI7AB5z5c5.png "ERC404的爆火让NFT再次伟大？技术角度解析其机制及原理")![ERC404的爆火让NFT再次伟大？技术角度解析其机制及原理](https://cdn-img.panewslab.com/panews/images/4C292We4xY.png "ERC404的爆火让NFT再次伟大？技术角度解析其机制及原理")

批评的声音               赞美的声音

ERC404 独创了一种图币混合的方式，简单描述就是：
* 买入 1 Pandora Token，就会自动获得 1 Pandora NFT
* 余额不足 1 Pandora Token，你的 NFT 就会自动销毁
* 买入 1 Pandora NFT，你钱包里就会自动多 1 Token，同理卖出自动减少

用一张图表达目前 ERC404 的混合逻辑：

![ERC404的爆火让NFT再次伟大？技术角度解析其机制及原理](https://cdn-img.panewslab.com/panews/images/nB6amMDr4r.png "ERC404的爆火让NFT再次伟大？技术角度解析其机制及原理")

ERC404 游戏规则

以下就是目前的 5 种[[zh:潘多拉魔盒]]，它们有不同的稀有度，根据合约实现我们可以算出来概率：

![ERC404的爆火让NFT再次伟大？技术角度解析其机制及原理](https://cdn-img.panewslab.com/panews/images/ZXpt1aIA36.png "ERC404的爆火让NFT再次伟大？技术角度解析其机制及原理") 39.5%    ![ERC404的爆火让NFT再次伟大？技术角度解析其机制及原理](https://cdn-img.panewslab.com/panews/images/udtAph2F20.png "ERC404的爆火让NFT再次伟大？技术角度解析其机制及原理") 23.4%   ![ERC404的爆火让NFT再次伟大？技术角度解析其机制及原理](https://cdn-img.panewslab.com/panews/images/e0CWBderlp.png "ERC404的爆火让NFT再次伟大？技术角度解析其机制及原理") 19.5%   ![ERC404的爆火让NFT再次伟大？技术角度解析其机制及原理](https://cdn-img.panewslab.com/panews/images/H1zNoh44w4.png "ERC404的爆火让NFT再次伟大？技术角度解析其机制及原理") 11.7%   ![ERC404的爆火让NFT再次伟大？技术角度解析其机制及原理](https://cdn-img.panewslab.com/panews/images/jN1qFJsvK0.png "ERC404的爆火让NFT再次伟大？技术角度解析其机制及原理") 5.9%     ### 实现一个 ERC404

ERC404 的第一版代码写的并不好，或者说非常的差强人意。但它解决了一个最主要问题 —— 如何在一个合约内同时实现 ERC20 和 ERC721 的接口。

![ERC404的爆火让NFT再次伟大？技术角度解析其机制及原理](https://cdn-img.panewslab.com/panews/images/PR6x6U896e.png "ERC404的爆火让NFT再次伟大？技术角度解析其机制及原理")

三种协议的对比

我们把两个接口定义中不相关的部分屏蔽，对比下哪些接口是交叉或冲突的：

![ERC404的爆火让NFT再次伟大？技术角度解析其机制及原理](https://cdn-img.panewslab.com/panews/images/EbOXj9CIal.jpg "ERC404的爆火让NFT再次伟大？技术角度解析其机制及原理")

![ERC404的爆火让NFT再次伟大？技术角度解析其机制及原理](https://cdn-img.panewslab.com/panews/images/x7UqqS7PNr.jpg "ERC404的爆火让NFT再次伟大？技术角度解析其机制及原理")

可以发现，四个有冲突的接口都是转账相关，在 ERC20 中最后一个参数的语义是 amount ，也就是 token 的额度，而在 ERC721 中参数的语义是tokenId ，代表 NFT 的编号。

在 ERC404 的合约实现中，这个参数的语义被修改为 amountOrId ，区分什么时候是amount 什么时候是 tokenId 的方法也很简单：根据值的大小。

类似 1 BTC = 10^9 Sats ，在 ERC404 世界里，我们说的 1 Token 实际对应的值是 10^18 ，而 NFT 的 tokenId 一般是从 1 开始的自增整数，所以 amount 和 tokenId 虽然都是整数，但实际的数量级差很多。

比如 Pandora 合约是记录了当前已经 mint 了多少个 nft（目前是 68180 ），当 amountOrId 的值小于等于它时认为是 tokenId ，否则认为是 amount 。

这逻辑有用吗？有用。它合理吗？

除此之外，Transfer >= 1 Token 时，NFT 的逻辑并不是转移，而是原账户销毁、新账户铸造。这么操作的好处是匹配流通性而且实现起来简单（思考转移 token 不足 1 的情况），但却带来了夸张的 GAS 消耗。

参考这笔交易，转移 4 Token 的同时产生了 4 个 NFT 的销毁和 4 个 NFT 的铸造：

![ERC404的爆火让NFT再次伟大？技术角度解析其机制及原理](https://cdn-img.panewslab.com/panews/images/L7eTE9Q0Vy.png "ERC404的爆火让NFT再次伟大？技术角度解析其机制及原理")

交易消耗了 $64 的 GAS ### 新叙事和新机会

ERC404 的玩法带来了几个隐性的规则：
* Token 在 DEX 的价格与 NFT 在 Marketplace 的价格不会差太多。
* NFT 被铸造只有一种情况：收取了 1 Token。换言之，把稀有度低的 NFT 置换成稀有度高的唯一方法就是不停的交易 Token。
* Pandora Token 的总供应量为 10,000 枚，代表着 NFT 的最大数量为 1w 个，而且会随着 holder 数量的增加而减小（holder 越多，不足 1 Token 的情况会越常见）。

如果我掌握了稳定铸造「红色[[zh:潘多拉魔盒]]」的魔法，在[[zh:交易所]]买入 Token，然后在 NFT [[zh:市场]]高价卖掉，是不是可以无限套利？

先看看 Pandora 的价格，这些数据提供了套利的理论基础：

![ERC404的爆火让NFT再次伟大？技术角度解析其机制及原理](https://cdn-img.panewslab.com/panews/images/I038Szu1uj.png "ERC404的爆火让NFT再次伟大？技术角度解析其机制及原理")![ERC404的爆火让NFT再次伟大？技术角度解析其机制及原理](https://cdn-img.panewslab.com/panews/images/4S17k7QKZg.png "ERC404的爆火让NFT再次伟大？技术角度解析其机制及原理")

4.7E 买入 Token                  NFT 近一周的地板价均大于 5E

以上数据并没有筛选 NFT 的稀有度，这种情况下减去磨损的利润在 0.2E 左右。参考上文的隐形规则，如果我们能做到 mint 的永远都是稀有度高的红色[[zh:潘多拉]]，是不是利润空间更大了？

我们来看下 Pandora 的合约，看看在众多 KOL 笔下的「随机生成」到底是如何实现的：

![ERC404的爆火让NFT再次伟大？技术角度解析其机制及原理](https://cdn-img.panewslab.com/panews/images/3fMSe8yIV3.jpg "ERC404的爆火让NFT再次伟大？技术角度解析其机制及原理")

通过阅读合约实现可得，Pandora Box 的稀有度是伪随机，跟我们之前实现的 CryptoFish 项目类似， tokenId 是自增的，所以下一个 mint 出来的 NFT 稀有度是完全可预测的。

我们通过一段 JavaScript 脚本就可以纯本地推测，经验证这段逻辑是完全正确的：

![ERC404的爆火让NFT再次伟大？技术角度解析其机制及原理](https://cdn-img.panewslab.com/panews/images/wl7J8X5Wee.jpg "ERC404的爆火让NFT再次伟大？技术角度解析其机制及原理")

![ERC404的爆火让NFT再次伟大？技术角度解析其机制及原理](https://cdn-img.panewslab.com/panews/images/Y30cAIG7n8.webp "ERC404的爆火让NFT再次伟大？技术角度解析其机制及原理")

目前 Pandora 的 minted 自增值为 68180 ，也就是我们推测未来 100 个 NFT 中，命中红色稀有度的 ID 为：

68186/68201/68213/68227/68228/68257/68259/68262

如果不考虑当前 Pandora 项目的流动性降低，这会是一个非常热门的[[zh:金融]]行为。

### 总结

ERC404 和 Pandora 并不是第一个探索 NFT 流动性的协议项目，很早之前就有 NFT 碎片化的讨论，包括 ERC1155 也是对 NFT 的一种创新；

但为什么 ERC404 这次大家情绪如此高涨？我认为是 —— 名字起得好。

无奈 ERC404 第一版合约的实现非常差，所以官方也在积极推动 V2 版本、社区也有第三方实现 DN404，更有甚者搞了个新的协议叫做 ERC[[zh:911]] 🤡，起名属性拉满了。

![ERC404的爆火让NFT再次伟大？技术角度解析其机制及原理](https://cdn-img.panewslab.com/panews/images/H477KQmdLb.png "ERC404的爆火让NFT再次伟大？技术角度解析其机制及原理")流动性过年期间达到巅峰，目前回落明显

Pandora V1 的故事可能很快就大结局了，当前的版本有无数的缺陷足够击垮它，流动性和 Holders 也回落明显。但目前有越来越多的项目方在尝试 ERC404 模式，CoinMarketCap 上可统计的就有 25 个。

相信未来 NFT 流动性问题会有更多的解法，ERC404 也能真正的带来下一个 NFT summer。
